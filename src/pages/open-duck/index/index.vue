<route lang="json5">
{
  style: {
    navigationStyle: 'custom',
    navigationBarTitleText: 'å¼€å£é¸­',
  },
}
</route>

<template>
  <view class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
    <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
    <view
      class="bg-white/80 backdrop-blur-md shadow-sm"
      :style="{ paddingTop: safeAreaInsets?.top + 'px' }"
    >
      <view class="flex items-center justify-between px-4 py-3">
        <view class="flex items-center space-x-3">
          <view class="duck-logo w-10 h-10"></view>
          <text class="text-xl font-bold text-gray-800">å¼€å£é¸­</text>
        </view>
        <view class="flex items-center space-x-2">
          <text class="text-sm text-gray-600">{{ greeting }}</text>
          <text
            class="text-xs text-blue-500 px-2 py-1 bg-blue-50 rounded-full"
            @click="goToAppSelector"
          >
            åˆ‡æ¢åº”ç”¨
          </text>
        </view>
      </view>
    </view>

    <!-- æ»šåŠ¨å†…å®¹åŒºåŸŸ -->
    <scroll-view scroll-y class="flex-1" style="height: calc(100vh - 160px)">
      <!-- ç”¨æˆ·çŠ¶æ€å¡ç‰‡ -->
      <view class="p-4">
        <view class="bg-white/90 backdrop-blur-md rounded-2xl p-6 shadow-lg border border-white/50">
          <view class="flex items-center justify-between mb-4">
            <text class="text-lg font-semibold text-gray-800">ä»Šæ—¥ä½¿ç”¨æƒ…å†µ</text>
            <view class="flex items-center space-x-2">
              <text
                class="text-xs px-3 py-1 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-medium"
              >
                æ™®é€šç”¨æˆ·
              </text>
            </view>
          </view>

          <view class="grid grid-cols-3 gap-4">
            <view class="text-center">
              <text class="text-2xl font-bold text-blue-500 block">{{ todayMinutes }}</text>
              <text class="text-xs text-gray-500">åˆ†é’Ÿ</text>
            </view>
            <view class="text-center">
              <text class="text-2xl font-bold text-green-500 block">{{ todayWords }}</text>
              <text class="text-xs text-gray-500">å•è¯</text>
            </view>
            <view class="text-center">
              <text class="text-2xl font-bold text-purple-500 block">{{ todayConversations }}</text>
              <text class="text-xs text-gray-500">å¯¹è¯</text>
            </view>
          </view>

          <!-- è¿ç»­å­¦ä¹ å¤©æ•° -->
          <view
            class="mt-4 p-3 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl border border-yellow-200"
          >
            <view class="flex items-center justify-between">
              <text class="text-sm text-gray-700">è¿ç»­å­¦ä¹ </text>
              <text class="text-sm font-semibold text-orange-600">{{ currentStreak }}å¤©</text>
            </view>
            <view class="mt-2 bg-white rounded-full h-2">
              <view
                class="bg-gradient-to-r from-yellow-400 to-orange-500 h-2 rounded-full"
                :style="{ width: Math.min(currentStreak * 10, 100) + '%' }"
              ></view>
            </view>
          </view>
        </view>
      </view>

      <!-- åŠŸèƒ½åŒºåŸŸ -->
      <view class="px-4 pb-4">
        <view class="grid grid-cols-2 gap-4">
          <!-- å¯¹è¯æ¨¡å¼ -->
          <view
            class="feature-card bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl p-4 shadow-lg transform transition-all duration-300 hover:scale-105"
            @click="navigateTo('/pages/open-duck/chat/index')"
          >
            <view class="flex items-center justify-between">
              <view>
                <text class="text-white text-lg font-semibold block">å¯¹è¯æ¨¡å¼</text>
                <text class="text-blue-100 text-sm">AIæ™ºèƒ½å¯¹è¯</text>
              </view>
              <view class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                <text class="text-white text-xl">ğŸ’¬</text>
              </view>
            </view>
          </view>

          <!-- è¯é¢˜ç»ƒä¹  -->
          <view
            class="feature-card bg-gradient-to-br from-green-400 to-green-600 rounded-2xl p-4 shadow-lg transform transition-all duration-300 hover:scale-105"
            @click="navigateTo('/pages/open-duck/topics/index')"
          >
            <view class="flex items-center justify-between">
              <view>
                <text class="text-white text-lg font-semibold block">è¯é¢˜ç»ƒä¹ </text>
                <text class="text-green-100 text-sm">çƒ­é—¨è¯é¢˜</text>
              </view>
              <view class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                <text class="text-white text-xl">ğŸ“š</text>
              </view>
            </view>
          </view>

          <!-- åœ°é“ç¿»è¯‘ -->
          <view
            class="feature-card bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl p-4 shadow-lg transform transition-all duration-300 hover:scale-105"
            @click="navigateTo('/pages/open-duck/translate/index')"
          >
            <view class="flex items-center justify-between">
              <view>
                <text class="text-white text-lg font-semibold block">åœ°é“ç¿»è¯‘</text>
                <text class="text-purple-100 text-sm">æ™ºèƒ½ç¿»è¯‘</text>
              </view>
              <view class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                <text class="text-white text-xl">ğŸŒ</text>
              </view>
            </view>
          </view>

          <!-- æ‹ç…§çŸ­æ–‡ -->
          <view
            class="feature-card bg-gradient-to-br from-orange-400 to-orange-600 rounded-2xl p-4 shadow-lg transform transition-all duration-300 hover:scale-105"
            @click="navigateTo('/pages/open-duck/photo-story/index')"
          >
            <view class="flex items-center justify-between">
              <view>
                <text class="text-white text-lg font-semibold block">æ‹ç…§çŸ­æ–‡</text>
                <text class="text-orange-100 text-sm">å›¾ç‰‡ç†è§£</text>
              </view>
              <view class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                <text class="text-white text-xl">ğŸ“¸</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- èƒŒå•è¯åŒºåŸŸ -->
      <view class="px-4 pb-4">
        <view
          class="bg-white/90 backdrop-blur-md rounded-2xl p-4 shadow-lg border border-white/50 transform transition-all duration-300 hover:scale-105"
          @click="navigateTo('/pages/open-duck/vocabulary/index')"
        >
          <view class="flex items-center justify-between">
            <view class="flex items-center space-x-3">
              <view
                class="w-12 h-12 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center"
              >
                <text class="text-white text-xl">ğŸ“–</text>
              </view>
              <view>
                <text class="text-lg font-semibold text-gray-800 block">èƒŒå•è¯</text>
                <text class="text-sm text-gray-500">ä»Šæ—¥è¿˜éœ€å­¦ä¹  {{ remainingWords }} ä¸ªå•è¯</text>
              </view>
            </view>
            <view class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center">
              <text class="text-gray-400 text-lg">â€º</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ä¼šå‘˜æç¤º -->
      <view class="px-4 pb-4">
        <view
          class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl p-4 border border-yellow-200"
        >
          <view class="flex items-center justify-between">
            <view class="flex items-center space-x-3">
              <view
                class="w-10 h-10 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center"
              >
                <text class="text-white text-lg">ğŸ‘‘</text>
              </view>
              <view>
                <text class="text-sm font-semibold text-gray-800">å‡çº§ä¼šå‘˜</text>
                <text class="text-xs text-gray-600">è§£é”æ›´å¤šåŠŸèƒ½</text>
              </view>
            </view>
            <text class="text-xs text-orange-600 font-medium">ç«‹å³å‡çº§</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
</template>

<script setup lang="ts" name="OpenDuckHome">
import { ref, onMounted } from 'vue'
import { useOpenDuckStore } from '@/store/openDuck'

// è·å–å±å¹•è¾¹ç•Œåˆ°å®‰å…¨åŒºåŸŸè·ç¦»
const { safeAreaInsets } = uni.getSystemInfoSync()

// çŠ¶æ€ç®¡ç†
const openDuckStore = useOpenDuckStore()

// å“åº”å¼æ•°æ®
const greeting = ref('')
const currentStreak = ref(7)
const todayMinutes = ref(25)
const todayWords = ref(12)
const todayConversations = ref(3)
const remainingWords = ref(8)

// è®¾ç½®é—®å€™è¯­
const setGreeting = () => {
  const hour = new Date().getHours()
  if (hour < 12) {
    greeting.value = 'æ—©ä¸Šå¥½'
  } else if (hour < 18) {
    greeting.value = 'ä¸‹åˆå¥½'
  } else {
    greeting.value = 'æ™šä¸Šå¥½'
  }
}

// å¯¼èˆªæ–¹æ³•
const navigateTo = (url: string) => {
  uni.navigateTo({ url })
}

// å»åº”ç”¨é€‰æ‹©é¡µé¢
const goToAppSelector = () => {
  uni.reLaunch({ url: '/pages/app-selector/index' })
}

// æ˜¾ç¤ºå³å°†æ¨å‡º
const showComingSoon = () => {
  uni.showToast({ title: 'åŠŸèƒ½å³å°†æ¨å‡º', icon: 'none' })
}

onLoad(() => {
  setGreeting()
  // åŠ è½½ç”¨æˆ·å­¦ä¹ æ•°æ®
  openDuckStore.loadUserData()
})
</script>

<style lang="scss" scoped>
.duck-logo {
  position: relative;
  background: linear-gradient(45deg, #ffd700, #ffa500);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(255, 165, 0, 0.3);
}

.duck-logo::before {
  content: '';
  position: absolute;
  top: 15%;
  left: 50%;
  transform: translateX(-50%);
  width: 30%;
  height: 25%;
  background: #ff6b35;
  border-radius: 0 0 50% 50%;
  clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%);
}

.duck-logo::after {
  content: '';
  position: absolute;
  top: 40%;
  left: 25%;
  width: 3px;
  height: 3px;
  border-radius: 50%;
  background: #000;
  box-shadow: 10px 0 0 #000;
}

.feature-card {
  position: relative;
  overflow: hidden;
}

.feature-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}

.feature-card:active::before {
  left: 100%;
}

/* æ·»åŠ æ»šåŠ¨æ¡æ ·å¼ */
::-webkit-scrollbar {
  width: 4px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.1);
  border-radius: 2px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 0, 0, 0.2);
}
</style>
